<div class="container my-5">
  <div class="row">
    <div class="col-lg-12 col-md-12">
      <h1 class="text-center mb-4"><span class="badge badge-secondary">レビュー詳細</span></h1>
      <!--画像が添付されていれば表示する-->
      <% unless @review.image_id.nil? %>
        <div class="mx-auto bg-light mb-5">
          <%= attachment_image_tag @review, :image, size: "800x500", class: "d-block mx-auto" %>
        </div>
      <% end %>
      <h2 class="text-center"><strong><%= @review.title%></strong></h2>
    </div>
  </div>
  <div class="row">
    <div class="d-flex flex-wrap align-items-center col-md-12">
      <div class="col-md-3">
        <h4 class="text-center"><i class="fa fa-smile text-warning"></i>良かったところ<i class="fa fa-smile text-warning"></i></h4>
      </div>
      <div class="col-md-9 text-break">
        <p class="ml-5"><%=safe_join(@review.good_point.split("\n"),tag(:br))%></p>
      </div>
    </div>
  </div>
  <div class="row">
    <div class=" d-flex flex-wrap align-items-center col-md-12">
      <div class="col-md-3">
        <h4 class="text-center"><i class="fa fa-frown text-primary"></i>残念だったところ<i class="fa fa-frown text-primary"></i></h4>
      </div>
      <div class="text-break col-md-9">
        <p class="ml-5 text-break"><%=safe_join(@review.bad_point.split("\n"),tag(:br))%></p>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="text-center col-12 mb-5">
      <h4>総合評価</h4>
      <div class="evaluation" data-score="<%= @review.evaluation %>"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <% if @review.user == current_user %>
        <%= link_to "レビューを編集する", edit_review_path %>
        <%= link_to "レビューを削除する", review_path, method: :delete %>
      <% elsif admin_signed_in? %>
        <%= link_to "レビューを削除する", review_path, method: :delete %>
      <% end %>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 d-flex flex-wrap">
      <!--コメント機能-->
      <div class="col-md-4">
        <h5>コメント</h5>
        <% @review.comments.each do |comment| %>
          <div class="mb-4">
            <%= comment.user.name %>
            <div class="text-break">
              <%= comment.comment %>
            </div>
            <% if comment.user == current_user || admin_signed_in? %>
            <%= link_to "削除", review_comment_path(comment.review, comment), method: :delete %>
            <% end %>
          </div>
        <% end %>
        <% if user_signed_in? %>
          <%= form_with(model:[@review, @comments], local: true) do |f| %>
            <%= f.text_area :comment,placeholder: "コメントをここに" %>
            <div>
              <%= f.submit "送信する" %>
            </div>
          <% end %>
        <% end %>
        </div>
        <div class="col-md-2"></div>
        <!--通報機能-->
        <% if user_signed_in? || admin_signed_in? %>
          <div class="col-lg-6 text-center">
            <% if admin_signed_in? || @review.reported_by?(current_user) %>
              <% @review.reports.each do |report| %>
                <p><span class="text-danger">通報内容</span>：<%= report.report_text %></p>
                <%= link_to "通報取り消し", review_report_path(report.review, report), method: :delete %>
              <% end %>
            <% else %>
              <div class="switchdsp ">
              <label for="l-1">
              <span class="clicktxt"><i class="fa fa-exclamation-triangle text-warning"></i>通報する<i class="fa fa-exclamation-triangle text-warning"></i></span>
              </label>
              <input type="checkbox" id="l-1">
              <div class="dsp mt-3">
                <%= form_with(model:[@review, @report], local: true) do |f| %>
                  <%= f.text_area :report_text,placeholder: "通報内容を記載してください。" %>
                  <div class="mt-3">
                    <button type="submit">通報</button>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
<!--評価の☆マークのJavScript-->
<script>
  $('.evaluation').empty();
  $('.evaluation').raty({
    readOnly: true,
    score: function() {
      return $(this).attr('data-score');
    },
    path: '/assets/'
  });
</script>